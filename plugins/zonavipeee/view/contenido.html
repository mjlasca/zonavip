{include="header2"}
<div id="fb-root"></div>
<script>(function(d, s, id) {
var js, fjs = d.getElementsByTagName(s)[0];
if (d.getElementById(id)) return;
js = d.createElement(s); js.id = id;
js.src = "https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v3.0";
fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



<section id="post" class="container">
    
    <div class="row">

        <div class="col-4 text-left">
            {if="$fsc->previewpost"}
                <h1 ><a style="text-align: right;" href="{$fsc->url()}&post={$fsc->previewpost['reg']}"><i class="fas fa-caret-square-left text-primary"></i></a></h1>
            {/if}
        </div>
        <div class="col-4 text-center">
            <h1 ><a href="index.php?page=zonavip"><i class="fas fa-home"></i></a></h1>
        </div>
        
        <div class="col-4" style="text-align: right;">
            {if="$fsc->nextpost"}
                <h1 ><a style="text-align: right;" href="{$fsc->url()}&post={$fsc->nextpost['reg']}"><i class="fas fa-caret-square-right text-primary"></i></a></h1>
            {/if}
        </div>
        
        
    </div>
    
    <div class="contenido-post-pago">
        <div class="pantalla" >
            
                {if="$fsc->post->pago == 'SI' && $fsc->allow == 0  && !$fsc->aprobaracceso($fsc->post->grupo) "}
                    <a href="#" data-toggle="modal" data-target="#modalcv"><div class="bloqueado">
                    </div></a>
                    <img  width="100%" src="{$fsc->post->urlminiatura}">
                {else}
                    {if="$fsc->post->idvimeo != '' "}
                    <iframe width="100%" height="100%" src="https://player.vimeo.com/video/{$fsc->post->idvimeo}" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                    {/if}
                    {if="$fsc->post->idyoutube != '' "}
                        <iframe width="100%" height="100%" src="https://www.youtube.com/embed/{$fsc->post->idyoutube}?rel=0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                    {/if}
                {/if}
                
            
            
        </div>

        <div class="etiquetas" >
            <div class="row">
                <div class="col-sm-8">
                    <a href="index.php?page=contenidofiltrado&categoria={$fsc->post->categoria}"><h5><span class="badge bg-dark text-white">{$fsc->post->categoria}</span></h5></a>
                </div>
                {if="$fsc->post->idyoutube != '' "}
                <div class="col-4" style="text-align: right;">
                    <a  href="https://www.youtube.com/watch?v={$fsc->post->idyoutube}&sub_confirmation=1" target="_blank"><h5><span class="badge bg-primary text-white">Ir a youtube</span></h5></a>
                </div>
                {/if}
            </div>
            
            
        </div>

        <div class="descripcion">
            <h4>{$fsc->post->nombrevideo}</h4>
            <div class="detalle" >
                {$fsc->post->detalle}
            </div>
            <div class="row pb-4">
                
                {if="$fsc->post->archivodescarga != '' "}
                
                <div class="col-sm-6">
                    <hr>        
                    <p><b>Puedes descargar el archivo utilizado en el vídeo</b></p>
                    <a type="button" class="btn btn-primary" href="{$fsc->post->archivodescarga}" target="_blank" >
                        Clic para descargar archivo 
                    </a>
                </div>
                {/if}
                {if="$fsc->post->pdf != '' "}
                <div class="col-sm-6">
                    <p><b>Archivo PDF</b></p>
                    <a type="button" class="btn btn-primary" href="{$fsc->post->pdf}" target="_blank" >
                        Clic para descargar archivo <span class="badge bg-secondary">.pdf</span>
                    </a>
                </div>
                {/if}
            </div>
            
            
        </div>

        <!-- Your share button code -->
        {if="$fsc->post->idyoutube != '' "}
        <div class="fb-share-button" style="float: right;font-size: 20px;" 
        data-href="https://www.youtube.com/watch?v={$fsc->post->idyoutube}" 
        data-layout="button_count">
        </div>
        {/if}

    </div>

    
    

    {if="$fsc->recomendaciones"}
    <div class="recomendaciones">
        <h3 >También te puede interesar</h3>
        <div class="row">
            {loop="$fsc->recomendaciones"}
                <div class="col-sm-4 recomendaciones-cuadro mt-3">
                    <div class="contenido-post">
                        {if="$value->pago == 'SI' && $fsc->allow == 0  && !$fsc->aprobaracceso($value->grupo)"}
                        <a href="#" data-toggle="modal" data-target="#modalcv"><div class="bloqueado">
                        </div></a>
                        {else}
                        <a href="index.php?page=contenido&post={$value->reg}" ><div class="abrirventana">
                        </div></a>
                        {/if}
                        
                        {if="$value->urlminiatura != '' "}
                        <img  width="100%" height="180px" src="{$value->urlminiatura}">
                        {else}

                            {if="$value->idvimeo != '' "}
                            <iframe class="mt-3" width="100%" height="100%" src="https://player.vimeo.com/video/{$value->idvimeo}" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                            {/if}
        
                            {if="$value->idyoutube != '' "}
                                <iframe class="mt-3" width="100%" height="100%" src="https://www.youtube.com/embed/{$value->idyoutube}" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                            {/if}
                        {/if}
                    </div>
                    <p>{$value->nombrevideo}</p>
                </div>
            {/loop}
        </div>
    </div>
    {/if}


    {if="$fsc->post->pago == 'SI' && $fsc->allow != 0  || $fsc->aprobaracceso($fsc->post->grupo) "}
        <h2 class="mt-5">Comentarios</h2>
        <div class="comentarios-pago ">
            <div id="comentario">
            </div>
            <div class="form-group">
                <textarea class="form-control" name="" id="mensaje" rows="3" placeholder="Deja un comentario"></textarea>
                <button class="btn btn-primary" id="botenviarcomentario" onclick="newmsg('','{$fsc->user->nick}')">Enviar Comentario</button>
                <button id="botcancelar"  class="btn btn-danger" onclick="reset()">Cancelar</button>
            </div>
        </div>
    {/if}

</section>
        

<!-- Modal -->
<div class="modal fade" id="modalcv" tabindex="-1" role="dialog" aria-labelledby="modalcv" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
        <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
        </div>
        <div class="modal-body  pl-5 pr-5">
        <h3>CONTENIDO PREMIUM EXCLUSIVO</h3>
        <p>Éste vídeo hace parte del contenido premium exclusivo, si deseas saber cómo tener acceso a éste material, clic en el siguiente botón</p>

        
        <a class="btn btn-danger" href="index.php?page=cvzonavip" > 
            <h5> <i class="fas fa-arrow-alt-circle-up"></i> ¡Inscribirme YA! <i class="fas fa-arrow-alt-circle-up"></i> </h5>
        </a>

        </div>
    </div>
    </div>
</div>


        
    

{include="footerusu"}

<link href="plugins/zonavipeee/view/css/contenido.css" rel="stylesheet" />

<script>

    

    $("#botcancelar").hide();
    const url = "{$fsc->url()}&post={$fsc->post->reg}";
    const grupo = "{$fsc->grupo}";
    const pago = "{$fsc->pago}";
    var regmensaje = '';
    var userresponde = '';
    var usuarioactual = "{$fsc->user->nick}";
    var adminuser = "{$fsc->user->admin}";

    if(grupo){
        $("#grupo").val(grupo);
    }

    if(pago){
        $("#pago").val(pago);
    }

    function enviarForm(){
        let error = "";
        $("#errores").html("");
        if($("#idvimeo").val() == "" && $("#idyoutube").val() == ""){
            error += "Por favor ingrese el idviemo o el idyoutube</br>";
        }
        if($("#idvimeo").val() != "" && $("#idyoutube").val() != ""){
            error += "Por favor ingrese sólo el idviemo o el idyoutube, NO ambos</br>";
        }

        if(error != ""){
            $("#errores").html("<div class='alert alert-warning alert-dismissible hidden-print' role='alert'><p class='text-left'><b>"
                +error+
                "</b></p></div>"
            );
            return false;
        }
        else
            return true;
    }

    getcomentarios();

    async function getcomentariosp() {
        return new Promise(function(resolve) {
            $.getJSON(url, 'getcomentarios=true', function (json) {
                
                resolve(
                    JSON.parse( JSON.stringify( json ) )
                );
            });

        })
    }

    async function getcomentarios(reg){

        let mensaje = [];
        
        let botcerrar = "";

        await getcomentariosp(reg).then(res =>{
            
            return res
            
        }).then(respuesta => {
            
            respuesta.forEach(val => {
                
                if(usuarioactual == val.user || adminuser){
                    botcerrar = `<button type="button" class="close" data-dismiss="alert" aria-label="Close" onclick="eliminarmensaje(${val.reg})">
                            <span aria-hidden="true">&times;</span>
                        </button>`;
                }


                if(val.regmensajeresponde == '' || val.regmensajeresponde == null){
                    mensaje.push(`<div class="alert alert-light" role="alert">
                        ${botcerrar}
                        <small class="text-success text-right">${val.ultmod} / ${val.nombre}</small>
                        <p>${val.mensaje}</p> <small><span class='text-warning text-righ' style="cursor:pointer;" onclick="respuestamensaje('${val.reg}','${val.nombre}')">Responder</span></small>
                    `); 
                    
                    mensaje.push(`<div id='respuestas${val.reg}'></div></div>`);
                }

               
            });

            $("#comentario").html(mensaje);

            respuesta.forEach(val => {
                if(val.regmensajeresponde != null){
                    let mensaje1 = [];
                    mensaje1.push($("#respuestas"+val.regmensajeresponde).html());
                    mensaje1.push(`<div class="alert alert-light ml-4" role="alert">
                        ${botcerrar}
                        <small class="text-success text-right"><i class="fas fa-angle-right"></i> ${val.ultmod} / ${val.nombre}</small>
                        <p>${val.mensaje}</p>
                        
                        
                        </div>
                    `); 
                    $("#respuestas"+val.regmensajeresponde).html(mensaje1);        
                }
            });
        } ).catch(error => {
        console.error("Error al traer datos del cliente");
        });
    }

    async function newmsgp(msg,user) {
        return new Promise(function(resolve) {
            $.getJSON(url, 'insertmsg='+msg+'&user='+user+'&regmensaje='+regmensaje+'&userresponse='+userresponde, function (json) {
                
                resolve(
                    JSON.parse( JSON.stringify( json ) )
                );
            });

        })
    }

    async function newmsg(msg,user){
        let mensaje = [];
        msg =$("#mensaje").val();
        mensaje.push($("#comentario").html());
        

        await newmsgp(msg,user).then(res =>{
            
                mensaje.push(`<div class="alert alert-light" role="alert">
                    
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close" onclick="eliminarmensaje(${res.reg})">
                            <span aria-hidden="true">&times;</span>
                    </button>
                    <small class="text-success text-right">${res.ultmod} / ${res.user}</small>
                    <p>${res.mensaje}</p> <small><span class='text-warning text-righ' style="cursor:pointer;" onclick="respuestamensaje('${res.reg}','${res.user}')">Responder</span></small>
                </div>`);    
            if(regmensaje != ''){
                $("#respuestas"+regmensaje).append(`<div class="alert alert-light ml-4" role="alert">
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                    </button>
                    <small class="text-success text-right">${res.ultmod} / ${res.user}</small>
                    <p>${res.mensaje}</p>
                </div>`);
                regmensaje = '';
                userresponde = '';
            }else
                $("#comentario").html(mensaje);

            reset();

        }).catch(error => {
        console.error("Error al enviar comentario ");
        });
    }

    function reset(){
        regmensaje = '';
        userresponde = '';
        $("#mensaje").val("");
        $("#mensaje").attr("placeholder","Deja un comentario");
        $("#botenviarcomentario").text("Enviar Comentario")
        $("#botcancelar").hide();
    }


    async function eliminarmensaje1(reg) {
        return new Promise(function(resolve) {
            $.getJSON(url, 'eliminarcomentario='+reg, function (json) {
                resolve(
                    JSON.parse( JSON.stringify( json ) )
                );
            });
        })
    }

    async function eliminarmensaje(reg){
        let mensaje = [];
        msg =$("#mensaje").val();
        mensaje.push($("#comentario").html());
        

        await eliminarmensaje1(reg).then(res =>{}).catch(error => {
        console.error("Error al enviar comentario");
        });

        $("#respuestas"+reg).remove();

    }

    function respuestamensaje(reg,user){
        $("#mensaje").focus();
        $("#mensaje").attr("placeholder","Escribe la respuesta");
        $("#botenviarcomentario").text("Enviar Respuesta")
        $("#botcancelar").show();
        regmensaje = reg;
        userresponde = user;
    }

   


</script>

